---
title: "Portfolio for Computational Musicology"
author: "Nora Saleh"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    storyboard: true
    self_contained: false
    theme:
      heading_font:
        google: 
          family: Rajdhani
          wght: 700
      base_font:
        google: Fira Sans
      code_font:
        google: Fira Mono
      bg: "#FFFFFF"
      fg: "#212529" 
      primary: "#2b2bee"
      secondary: "#39d7b8"
      success: "#39d7b8"
      danger: "#fa5577"
      warning: "#ffb14c"
      info: "#0cc7f1"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(spotifyr)
library(ggplot2)
library(gapminder)
library(spotifyr)
library(tidyverse)
library(usethis)
library(plotly)
library(remotes)
library(compmus)

library(tidymodels)
library(heatmaply)
library(protoclust)
```

Column {data-width=650}
-----------------------------------------------------------------------
### Introduction
The corpus will consist of K-pop songs spanning two distinct eras in the genre's evolution: the 2nd generation (2005-2011) and the 4th generation (2018-2022).  K-pop is getting increasingly more popular outside South-Korea, captivating audiences with its infectious melodies. Through this corpus, I aim to explore the diverse sounds, themes, and trends within the genre, shedding light on its evolution. The 2nd generation witnessed the rise of iconic groups like Girls' Generation and Big Bang. In contrast, the 4th generation marked a new era of global influence, with groups such as BTS and BLACKPINK reaching unprecedented levels of success. I expect significant differences between the 2nd and 4th generation tracks in terms of sound, production techniques. The 4th generation is likely to showcase a broader range of genres, experimental production styles.

### Chart A

```{r}
secondgg <- get_playlist_audio_features("", "53gZC84IKZk5QoOqSwgUg9")
fourthgg <- get_playlist_audio_features("", "0XlcubxUyMwSOP3GOgzbQR")
secondbg <- get_playlist_audio_features("", "0UqgifAkmHt86pzVTfBcmS")

secondgg |>
  summarise(
    mean_speechiness = mean(speechiness),
    mean_acousticness = mean(acousticness),
    mean_liveness = mean(liveness),
    sd_speechiness = sd(speechiness),
    sd_acousticness = sd(acousticness),
    sd_liveness = sd(liveness),
    median_speechiness = median(speechiness),
    median_acousticness = median(acousticness),
    median_liveness = median(liveness),
    mad_speechiness = mad(speechiness),
    mad_acousticness = mad(acousticness),
    mad_liveness = mad(liveness)
  )

awards <-
  bind_rows(
    secondgg |> mutate(category = "Second Generation"),
    fourthgg |> mutate(category = "Fourth Generation")
  )

secondgg |> ggplot(aes(x = energy)) + geom_histogram(binwidth = 0.1)

awards |>
  ggplot(aes(x = energy)) +
  geom_histogram(binwidth = 0.1) +
  facet_wrap(~category)

awards |>
  ggplot(aes(x = category, y = energy)) +
  geom_boxplot()

awards |>
  ggplot(aes(x = category, y = energy)) +
  geom_violin()

secondgg |> ggplot(aes(x = valence, y = energy)) + geom_point() + geom_smooth()
```

### Chart B

```{r}
awards |>                    # Start with awards.
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  ) |>
  ggplot(                     # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode
    )
  ) +
  geom_point() +              # Scatter plot.
  geom_rug(linewidth = 0.1) + # Add 'fringes' to show data distribution.
  geom_text(                  # Add text labels from above.
    aes(
      x = valence,
      y = energy,
      label = label
    ),
    data = 
      tibble(
        label = c(""),
        category = c("Fourth", "Second"),
        valence = c(0.104, 0.0339),
        energy = c(0.992, 0.00166)
      ),
    colour = "black",         # Override colour (not mode here).
    size = 3,                 # Override size (not loudness here).
    hjust = "left",           # Align left side of label with the point.
    vjust = "center",         # Align vertical center of label with the point.
    nudge_x = 0.02            # Nudge the label slightly right.
  ) +
  facet_wrap(~ category) +    # Separate charts per playlist.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL       # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(        # Use the Color Brewer to choose a palette.
    type = "qual",            # Qualitative set.
    palette = "Paired"        # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(      # Fine-tune the sizes of each point.
    trans = "exp",            # Use an exp transformation to emphasise loud.
    guide = "none"            # Remove the legend for size.
  ) +
  theme_light() +             # Use a simpler theme.
  labs(                       # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )
```

